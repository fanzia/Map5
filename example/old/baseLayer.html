<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/bootstrap-3.2.0-dist/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/Map5.css"/>

<script type="text/javascript" src="../lib/jquery-1.11.1.js"></script>
<script type="text/javascript" src="../lib/bootstrap-3.2.0-dist/bootstrap.min.js"></script>
<!-- <script type="text/javascript" src="../lib/Map5.min.js"></script> -->
<script type="text/javascript" src='../lib/requestNextAnimationFrame.js'></script>
<script type="text/javascript" src="../lib/GeoBeans.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Class.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Envelope.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Color.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/ColorRangeMap.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/User.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Map.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/DBS/DBSManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/File/FileManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/TileDB/TileDBManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/RasterDB/RasterDBManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/GPS/GPSManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Poi/PoiManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Subscribe/SubManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Service/Service.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Service/ServiceManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/JobManager.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Geometry.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GeometryCollection.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Point.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/LineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Line/LinearRing.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Polygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPoint.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiLineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPolygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Circle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GML.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Label.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Label/PointLabel.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Field.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Feature.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/FeatureType.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Workspace.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/WFS/WFSWorkspace.js"></script>


<script type="text/javascript" src="../lib/GeoBeans/Transformation.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Filter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/FilterReader.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/FilterWriter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/LogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/LogicFilter/BinaryLogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/ComparisionFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/ComparisionFilter/BinaryComparisionFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/IDFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/UnaryLogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/SpatialFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/SpatialFilter/BBoxFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/Expression.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/PropertyName.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/Literal.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapWorkspace.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Control.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/TrackControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/DragMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/SrollMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/MapNavControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/ZoomControl.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Renderer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/ColorMap.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleReader.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleWriter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Rule.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/FeatureStyle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Symbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PointSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/LineSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PolygonSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/TextSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Font.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Stroke.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Fill.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Events.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/InfoWindow.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Layer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/Tile.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileCache.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer/QSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/FeatureLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/WFSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/DBLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/GroupLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/FeatureDBLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/OverlayLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/QueryLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/ImageLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer/WMTSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/PanoramaLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/GeoLineLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/ChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/SymbolChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/RingChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/RippleLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/AirLineLayer.js"></script>


<script type="text/javascript" src="../lib/GeoBeans/Overlay.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Overlay/Marker.js"></script>



<script type="text/javascript">
	var mapObj = null;
	// var username = "user1";
	// var mapName = "t6";
	var username = "radi";
	var mapName = "莆田系医院";	
	var mapManager = null;
	function init(){
		var user = new GeoBeans.User(username);
		mapManager = user.getMapManager();
		mapObj = mapManager.getMap("mapDiv",mapName);
		if(mapObj == null){
			alert("没有该地图");
			return;
		}
		
		mapObj.draw();

	}

	// 本地添加，不注册到用户
	function addQuadServerLayer(){
		var layer = new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_image");
		mapObj.setBaseLayer(layer);
		var viewer = mapObj.viewer;
		// var level = mapObj.getLevel(viewer);
		// if(level == null){
		// 	level = 2;
		// }
		var center = mapObj.center;
		if(center == null){
			center = new GeoBeans.Geometry.Point(0,0);	
		}
		mapObj.setCenter(center);
		// mapObj.setLevel(2);	
		mapObj.baseLayer.MAX_ZOOM_LEVEL = 10;
		mapObj.draw();
	}

	// 本地添加，不注册到用户
	function addQuadServerLayer2(){
		var layer = new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_image");
		mapObj.setBaseLayer(layer);
		var viewer = mapObj.viewer;
		var center = mapObj.center;
		if(center == null){
			center = new GeoBeans.Geometry.Point(0,0);	
		}
		mapObj.setCenter(center);
		mapObj.setLevel(3);	
		mapObj.baseLayer.MAX_ZOOM_LEVEL = 10;
		mapObj.draw();
	}

	function removeBaseLayer(){
		mapObj.removeBaseLayer();
		mapObj.draw();
	}


	function setBaseLayerVisible(){
		var baseLayer = mapObj.baseLayer;
		if(baseLayer == null){
			return;
		}
		if(baseLayer.visible){
			baseLayer.setVisiable(false);
		}else{
			baseLayer.setVisiable(true);
		}
		mapObj.draw();
	}

	function addBaseLayerImage(){
		var layer = new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_image");
		mapObj.setBaseLayer(layer);
		var center = mapObj.center;
		if(center == null){
			center = new GeoBeans.Geometry.Point(0,0);	
		}
		mapObj.setCenter(center);
		mapObj.setLevel(2);	
		mapObj.baseLayer.MAX_ZOOM_LEVEL = 10;

		mapObj.draw();
	}


	function registerLayer(){
		var layer = new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_vector");
		mapObj.insertLayer(layer,registerLayer_callback);
	}

	function registerImageLayer(){
		var layer = new GeoBeans.Layer.QSLayer("image","/QuadServer/maprequest?services=world_image");
		mapObj.insertLayer(layer,registerLayer_callback);		
	}

	function registerLayer_callback(result){
		alert(result);
		mapObj.draw();
	}


	function unregisterLayer(){
		mapObj.unRegisterBaseLayer(unregisterLayer_callback);

	}

	function unregisterLayer_callback(result){
		alert(result);
		mapObj.draw();
	}


	function saveMap(){
		mapManager.saveMap(mapObj,saveMap_callback);
	}

	function saveMap_callback(result){
		alert("saveMap " + result);
	}

	function refreshMap(){
		mapManager.refreshMap(mapObj,refreshMap_callback);
	}


	function refreshMap_callback(result){
		mapObj.draw();
		alert(result);
	}


	function addWMTSLayer(){
		var extent = new GeoBeans.Envelope(-180,-90,180,90);
		var layer = new GeoBeans.Layer.WMTSLayer("base","/ows/user1/mgr","quanqiu",
			extent,"GoogleCRS84Quad","image/png","tfs");
		mapObj.setBaseLayer(layer);
		mapObj.setLevel(3);
		mapObj.draw();
	}


	function registerWMTSLayer(){
		var extent = new GeoBeans.Envelope(-180,-90,180,90);
		var layer = new GeoBeans.Layer.WMTSLayer("base","/ows/user1/mgr","quanqiu",
			extent,"GoogleCRS84Quad","image/png","tfs",1,5);
		layer.MIN_ZOOM_LEVEL = 1;
		layer.MAX_ZOOM_LEVEL = 4;
		mapObj.insertLayer(layer,registerLayer_callback);		
	}


	function zoomIn(){
		mapObj.zoomIn();
	}

	function zoomOut(){
		mapObj.zoomOut();
	}

	function endQuery(){
		mapObj.endZoom();
	}

</script>
<body onload="init()">


	<button onclick="addQuadServerLayer()">本地添加</button>
	<button onclick="addQuadServerLayer2()">本地添加-设置级别</button>
	<button onclick="removeBaseLayer()">本地删除</button>
	
	<!-- <button onclick="addBaseLayerImage()">影像</button> -->


	<button onclick="registerLayer()">注册-矢量</button>
	<button onclick="registerImageLayer()">注册-影像</button>
	<button onclick="setBaseLayerVisible()">显示</button>
	<button onclick="unregisterLayer()">注销</button>

	<button onclick="saveMap()">保存</button>
	<button onclick="refreshMap()">刷新</button>


	<br/>
	WMTS
	<button onclick="addWMTSLayer()">本地添加-WMTS</button>

	<button onclick="registerWMTSLayer()">注册-WMTS</button>
	<br/>

	<button onclick="zoomIn()">拉框放大</button>
	<button onclick="zoomOut()">拉框缩小</button>
	<div id="mapDiv" style="height:800px;width:100%;position:absolute;top:120px;">
	<!-- <div id="mapDiv" style="height:400px;width:600px;position:absolute;top:30px;"> -->
	</div>
	

	<span>test</span>
</body>