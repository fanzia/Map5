<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/bootstrap-3.2.0-dist/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/Map5.css"/>
<link rel="stylesheet" type="text/css" href="../css/custom_slider.css"/>

<script type="text/javascript" src="../lib/jquery-1.11.1.js"></script>
<script type="text/javascript" src="../lib/bootstrap-3.2.0-dist/bootstrap.min.js"></script>
<script type="text/javascript" src="../lib/jquery.nouislider.js"></script>
<script type="text/javascript" src="../lib/echarts-all.js"></script>
<script type="text/javascript" src="../lib/GeoBeans.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Class.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Envelope.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Color.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/ColorRangeMap.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/User.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Map.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/DBS/DBSManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/File/FileManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/TileDB/TileDBManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/RasterDB/RasterDBManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/GPS/GPSManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Poi/PoiManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Subscribe/SubManager.js"></script>


<script type="text/javascript" src="../lib/GeoBeans/Geometry.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GeometryCollection.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Point.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/LineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Line/LinearRing.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Polygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPoint.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiLineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPolygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Circle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GML.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Label.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Label/PointLabel.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Field.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Feature.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/FeatureType.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Workspace.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/WFS/WFSWorkspace.js"></script>


<script type="text/javascript" src="../lib/GeoBeans/Transformation.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Filter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/FilterReader.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/FilterWriter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/LogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/LogicFilter/BinaryLogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/ComparisionFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/ComparisionFilter/BinaryComparisionFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/IDFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/UnaryLogicFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/SpatialFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/SpatialFilter/BBoxFilter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/Expression.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/PropertyName.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/Literal.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Filter/OrderBy.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapWorkspace.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Control.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/TrackControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/DragMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/SrollMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/MapNavControl.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Renderer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/ColorMap.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Symbol.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleReader.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleWriter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Rule.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/FeatureStyle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Symbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PointSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/LineSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PolygonSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/TextSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Font.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Stroke.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Fill.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Events.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/InfoWindow.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Layer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/Tile.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileCache.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer/QSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/FeatureLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/WFSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/DBLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/GroupLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/FeatureDBLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/OverlayLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/QueryLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/ImageLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer/WMTSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/PanoramaLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/GeoLineLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/RippleLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/ChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/SymbolChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/RingChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/AQIChartLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/chart/AQITimelineLayer.js"></script>


<script type="text/javascript" src="../lib/GeoBeans/Overlay.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Overlay/Marker.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/AQI/TimeLineBar.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/AQI/AQIIndexChart.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/AQI/AQIStatCompChart.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/AQI/AQITimePointList.js"></script>
<script type="text/javascript">

var mapObj = null;
var tracker = null;
var mapManager = null;
var url = "/ows/user1/mgr";
var userName = "user1";
var mapName = "0330"; 
var station_code = null;
function init(){
	var user = new GeoBeans.User(userName);
	var mapManager = user.getMapManager();

	mapObj = mapManager.getMap("mapDiv",mapName);

	if(mapObj == null){
		alert("没有该地图");
		return;
	}
	mapObj.setViewer(mapObj.extent);
	mapObj.setNavControl(false);
	mapObj.draw();
}

function onMapMove(evt){
	var mapX = evt.mapX;
	var mapY = evt.mapY;
	
	var str = mapX + "," + mapY + ";";
	str += evt.X + "," + evt.Y + "<br/>";
	var map = mapObj.transformation.toMapPoint(mapX,mapY);
	// str += map.x + "," + map.y;
	document.getElementById("xy").innerHTML = str;
}



function addLayer_callback(result){
	if(result == "success"){
		mapObj.draw();
	}else{
		alert(result);
	}
}

function onAddChartLayer(){
	// var option = {
	// 	colorMapID 		: 4,
	// 	opacity 		: 0.6,
	// 	border 			: "#efefef",
	// 	borderOpacity	: 1.0
	// };
	var option = {
		colorMapID : 2,
		type : "tip"
	};


	var layer = new GeoBeans.Layer.AQIChartLayer("aqi","base",
		"gc_aqi","pm2_5","position_name","station_code","time_point","2014-05-19 08:00:00",option);
	mapObj.addLayer(layer,addLayer_callback);
}


function onAddChartLayerPoint(){
	var option = {
		colorMapID : 2,
		type : "point"
	};


	var layer = new GeoBeans.Layer.AQIChartLayer("aqi","base",
		"gc_aqi","pm2_5","position_name","station_code","time_point","2014-05-19 08:00:00",option);
	mapObj.addLayer(layer,addLayer_callback);
}

function removeChart(){

	mapObj.removeLayer("aqi");
	mapObj.draw();
}

function registerHitEvent(){
	var layer = mapObj.getLayer("aqi");
	if(layer != null){
		var html = "<a href='javascript:void(0)' class='aqi_info'>查看24小时变化情况</a>";
		layer.registerHitEvent(html,callback);
	} 
}

function callback(code){
	// this.station_code = station_code;
	station_code = code;
	var that = this;
	$(".aqi_info").click(function(){
		mapObj.closeInfoWindow();
		var container = document.getElementById("chart_panel");
		var aqiIndexChart = new GeoBeans.AQIIndexChart("统计图",container,"base",
			"gc_aqi",["aqi","pm2_5"],"station_code",station_code,"time_point",
			"2014-05-20 00:00","2014-05-21 00:00");
		aqiIndexChart.setMap(mapObj);
		$("#dialog").modal();
		aqiIndexChart.show();

	});	
}



function stationCompareChart(){
	var container = document.getElementById("chart_panel");
	var stationCodes = ["1023A","1111A"];
	var chart = new GeoBeans.AQIStatCompChart("站点对比图",container,"base",
			"gc_aqi",["aqi","pm2_5"],"station_code",stationCodes,"time_point",
			"2014-05-20 00:00","2014-05-21 00:00","position_name");
	chart.setMap(mapObj);
	$("#dialog").modal();
	chart.show();
}

function getTimeList(){
	var timeList = new GeoBeans.AQITimePointList("time","base","gc_aqi_uptime","uptime","2014-05-20 00:00","2014-05-21 00:00");
	timeList.setMap(mapObj);
	var list = timeList.getTimeList();
	var time = null;
	var html = "";
	for(var i = 0; i< list.length; ++i){
		html += "<span> '" + list[i] + "', </span>";
	}

	$("#timeList").html(html);
}

</script>


<title>Map5--AQI chart </title>
</head>

<body onload="init()">


<!-- <canvas id="myCanvas" width="800" height="800"></canvas> -->
	<div id="mapDiv" style="height:800px;width:100%;border:1px solid #ccc;position:relative">
		
	</div>

	<div id="xy" style="width:200px;height:30px;line-height:30px"></div> 
<input type="button" value="tip" onclick="onAddChartLayer();">
<input type="button" value="point" onclick="onAddChartLayerPoint();">
<input type="button" value="removeChart" onclick="removeChart();">
<input type="button" value="registerHitEvent" onclick="registerHitEvent();">
<input type="button" value="站点对比" onclick="stationCompareChart();">
<input type="button" value="时间列表" onclick="getTimeList();">
	<div id="timeList"></div>
	<div class="modal" id="dialog" tabindex="-1" role="dialog" aria-hidden="true">
	    <div class="modal-dialog" style="width:1000px">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
	                <h5 class="modal-title">展示图</h5>
	            </div>
	            <div class="modal-body" id="chart_panel" style="height:800px;">

	            </div>
	        </div>
	    </div>
	</div>

	
</body>
</html>




