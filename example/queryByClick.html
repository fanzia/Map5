<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/Map5.css"/>
<link rel="stylesheet" type="text/css" href="../css/bootstrap-3.2.0-dist/css/bootstrap.min.css"/>

<script type="text/javascript" src="../lib/jquery-1.11.1.js"></script>
<script type="text/javascript" src="../lib/bootstrap-3.2.0-dist/bootstrap.min.js"></script>

<script type="text/javascript" src="../lib/GeoBeans.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Class.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Envelope.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/BaseTypes/Color.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Geometry.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GeometryCollection.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Point.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/LineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/LinearRing.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Polygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPoint.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiLineString.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/MultiPolygon.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/Circle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Geometry/GML.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Field.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Feature.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/FeatureType.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Workspace.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/WFS/WFSWorkspace.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Transformation.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Filter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Style.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleReader.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/StyleWriter.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Rule.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/FeatureStyle.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Symbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PointSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/LineSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/PolygonSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/TextSymbolizer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Font.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Stroke.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Style/Fill.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Layer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/Tile.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileCache.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/TileLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/QSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/FeatureLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/WFSLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/DBLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/GroupLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/OverlayLayer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Layer/QueryLayer.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Renderer.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Events.js"></script>

<script type="text/javascript" src="../lib/GeoBeans/Control.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/TrackControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/DragMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/SrollMapControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Control/MapNavControl.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapManager.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/Map.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/MapWorkspace.js"></script>
<script type="text/javascript" src="../lib/GeoBeans/InfoWindow.js"></script>
<script type="text/javascript">

var mapObj = null;
var tracker = null;
var mapManager = null;
var url = "/ows/user1/mgr";
var features = null;
function init(){
	mapManager = new GeoBeans.MapManager(url);
	var center = new GeoBeans.Geometry.Point(0,0);

	// mapObj = new GeoBeans.Map("mapDiv");

	mapObj = mapManager.getMap("mapDiv","world");
	mapObj.setViewer(new GeoBeans.Envelope(-180,-90,180,90));

	// layer = new GeoBeans.Layer.QSLayer("gaode","/QuadServer/maprequest?services=world_image");				
	// mapObj.setBaseLayer(layer);
	// var center = new GeoBeans.Geometry.Point(0,0);	
	// mapObj.setCenter(center);
	// mapObj.setLevel(2);	

	mapObj.draw();

}

function onMapMove(evt){
	var mapX = evt.mapX;
	var mapY = evt.mapY;
	
	//var str = mapX + "," + mapY;
	var str = evt.X + "," + evt.Y;
	document.getElementById("xy").innerHTML = str;
}
// function Query_point(){
// 	mapObj.queryByRect("cities",query_callback);
// }

// function Query_line(){
// 	mapObj.queryByRect("rivers",query_callback);
// }

// function Query_polygon(){
// 	mapObj.queryByRect("country",query_callback);
// }

// function query_callback(layer,count){
// 	// alert("查询的个数：" + count);
// 	features = mapObj.queryByRectPage();
// 	$("#features_count").html(count);

// }

// function setFeatureBlink(){
// 	// var feature = v
// 	var id = $("#feature_id").val();
// 	var feature = features[id];
// 	var count = parseInt($("#blink_count").val());
// 	// var count = 1;
// 	mapObj.setFeatureBlink(feature,count);
// }

function query_cities(){
	mapObj.queryByClick("cities");
}

function query_rivers(){
	mapObj.queryByClick("rivers");
}
function query_country(){
	mapObj.queryByClick("country",query_callback);
}

function query_callback(layer,feature,point){
	if(feature == null || layer == null){
		return;
	}
	var fields = layer.getFields();
	if(fields == null){
		return;
	}
	var values = feature.values;
	if(values == null){
		return;
	}
	var html = "<table class='table table-striped'>"
			+ 	"<thead>"
			+ 	"<tr>"
			+ 	"<th>Field</th>"
			+ 	"<th>Value</th>"
			+	"</tr>"
			+	"</thead>"
			+ 	"<tbody>";
	for(var i = 0; i < fields.length;++i){
		field = fields[i];
		if(field == null){
			continue;
		}
		type = field.type;
		if(type != "geometry"){
			name = field.name;
			value = values[i];
			html += "<tr>"
			+  "	<td>" + name + "</td>"
			+  "	<td>" + value + "</td>"
			+  "	</tr>"
		}
	}
	html += "</tbody>";
	html += "</table>";

	var options = {
		title : layer.name
	};
	var infoWindow = new GeoBeans.InfoWindow(html,options);
	mapObj.openInfoWindow(infoWindow,point);

}

function end_query(){
	mapObj.endQuery();
}

</script>


<title>Map5--Query by click</title>
</head>

<body onload="init()">

<!-- <input type="button" value="Point" onclick="Query_point();">
<input type="button" value="Line" onclick="Query_line();">
<input type="button" value="Polygon" onclick="Query_polygon();">
选择的个数：<span id="features_count"></span>

闪烁：ID<input type="text" value="1" id="feature_id">
次数<input type="text" value="3" id="blink_count">
<input type="button" value="闪烁" onclick="setFeatureBlink();"> -->
<!-- <canvas id="myCanvas" width="800" height="800"></canvas> -->
	<div id="mapDiv" style="height:800px;width:100%">
	</div>
<input type="button" value="query_cities" onclick="query_cities();">
<input type="button" value="query_rivers" onclick="query_rivers();">
<input type="button" value="query_country" onclick="query_country();">
<input type="button" value="end_query" onclick="end_query();">
<!-- <div id="xy" style="width:200px;height:30px;line-height:30px"/>   -->
</body>
</html>




