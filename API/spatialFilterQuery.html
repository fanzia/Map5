<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/bootstrap-3.2.0-dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../css/Map5.min.css">
<script type="text/javascript" src="js/jquery-1.11.1.js"></script>
<script type="text/javascript" src="js/countryValue.js"></script>
<script type="text/javascript" src="js/riversValue.js"></script>
<script type="text/javascript" src="js/citiesValue.js"></script>
<script type="text/javascript" src="../lib/bootstrap-3.2.0-dist/bootstrap.min.js"></script>
<script type="text/javascript" src="../lib/Map5.min.js"></script>

<style type="text/css">
	body{
		margin: 0px;
	}
</style>
<script type="text/javascript">
	// 地图变量
	var mapObj = null;
	function  init(){
		
		// 地图的范围
		var extent = new GeoBeans.Envelope(-180,-90,180,90);
		
		// 地图的容器为"mapDiv",地图名称"map"，地图范围，地图的空间参考，4326为经纬度
		mapObj = new GeoBeans.Map("mapDiv","map",extent,4326);
		if(mapObj == null){
			return;
		}
		
		// 定义一个QuadServer图层，作为底图，第一个参数为图层名称，第二个参数为QuadServer地址
		var layer = new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_vector");

		// 添加图层
		mapObj.addLayer(layer);

		// 设置中心点
		var center = new GeoBeans.Geometry.Point(0,0);	
		mapObj.setCenter(center);

		// 设置级别
		mapObj.setLevel(3);	

		var server = "/geoserver/radi/ows?";
		// 增加country图层
		var countryLayer = new GeoBeans.Layer.WFSLayer("country", //在地图中的名称
											server, //服务器
											"radi:country_2", //图层在geoserver的名称
											"GML2"); // 格式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(220,121,198,0.04);
		symbolizer.stroke.color.set(36,47,87,0.46);
		rule.symbolizer = symbolizer;
		style.addRule(rule);
		countryLayer.setStyle(style);
		mapObj.addLayer(countryLayer);


		// 增加rivers图层
		var riversLayer = new GeoBeans.Layer.WFSLayer("rivers", //在地图中的名称
											server, //服务器
											"radi:rivers_2", //图层在geoserver的名称
											"GML2"); // 格式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.LineSymbolizer();
		symbolizer.stroke.color.set(255,65,65,1);
		rule.symbolizer = symbolizer;
		style.addRule(rule);
		riversLayer.setStyle(style);
		mapObj.addLayer(riversLayer);

		// 增加cities图层
		var citiesLayer = new GeoBeans.Layer.WFSLayer("cities", //在地图中的名称
											server, //服务器
											"radi:cities_2", //图层在geoserver的名称
											"GML2"); // 格式
		
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		symbolizer.fill.color.set(220,121,198,0.8);
		symbolizer.stroke = null;
		symbolizer.size = 6;
		rule.symbolizer = symbolizer;
		style.addRule(rule);
		citiesLayer.setStyle(style);		
		mapObj.addLayer(citiesLayer);

		// 绘图
		mapObj.draw();
	}
/* ---
	空间查询
	空间查询是和空间位置关系有关的查询，具体的查询支持类型有：
	Intersects、Dwithin、Within、Euqals、Disjoint 、Touches 、Crosses、Beyond 、Contains、Overlaps BBox等。
	空间查询filter的基类是GeoBeans.BinarySpatialFilter;
	

	var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);
	1、其中operator为操作符，同查询类型一致。
	GeoBeans.SpatialFilter.OperatorType.SpOprIntersects
	GeoBeans.SpatialFilter.OperatorType.SpOprDWithin
	GeoBeans.SpatialFilter.OperatorType.SpOprWithin
	GeoBeans.SpatialFilter.OperatorType.SpOprEquals
	GeoBeans.SpatialFilter.OperatorType.SpOprDisjoint
	GeoBeans.SpatialFilter.OperatorType.SpOprTouches
	GeoBeans.SpatialFilter.OperatorType.SpOprCrosses
	GeoBeans.SpatialFilter.OperatorType.SpOprBeyond 
	GeoBeans.SpatialFilter.OperatorType.SpOprContains
	GeoBeans.SpatialFilter.OperatorType.SpOprOverlaps
	GeoBeans.SpatialFilter.OperatorType.SpOprBBox

	2、propName 为图层的空间字段
	3、geometry 为查询的空间元素

	需要注意的是Dwithin、BBox和Beyond查询有单独的派生类，具体见下
---*/

/* ---
	1、Intersects查询
	intersects返回与给定geometry相交的记录
---*/

	function queryFeatures_intersects(){

		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprIntersects;

		// 2、定义查询的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 7、辅助显示查询的geometry，不影响查询
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}

	// 查询回调函数
	function queryFeatures_callback(features){

		// 返回查询的features
		if(!$.isArray(features)){
			return;
		}

		$("#result span").html(features.length);
		for(var i = 0; i< features.length;++i){
			var feature = features[i];
			var fid = feature.fid;
			console.log(fid);
		}
	}

	function clearQuery(){

		// 停止查询
		mapObj.endQuery();

		// 删除辅助显示的geometry
		mapObj.removeOverlay("test");
		mapObj.draw();

		//删除结果
		$("#result span").html("");
	}

/* ---
	2、Dwithin查询
	Dwithin返回与给定geometry距离在给定长度内的记录。当distance值为0，则为Within查询
---*/

	function queryFeatures_dwithin(){

		// 1、定义查询图层的空间字段
		var propName = "shape";
		
		// 2、定义查询的空间几何图形
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);

		// 3、定义查询的距离
		var distance = 10;

		// 4、定义Dwithin 查询过滤条件
		// 参数一：propName 为图层的空间字段
		// 参数二：geometry 为查询的空间元素
		// 参数三：distance 为查询的距离
		var filter = new GeoBeans.DistanceBufferFilter(propName,geometry,distance);


		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("cities",filter,maxFeatures,fields,style,queryFeatures_callback);		


		// 辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}

/* ---
	3、Within查询
	Within返回在geometry内的记录，用于拉框查询、多边形查询、视野内查询等。
---*/

	function queryFeatures_within(){

		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprWithin;
		var propName = "shape";
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);

		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 设定样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("cities",filter,maxFeatures,fields,style,queryFeatures_callback);		


		// 辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}

/* ---
	4、Equals查询
	Equals返回与给定geometry相同的记录
---*/	
	function queryFeatures_equals(){

		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprEquals;

		// 2、定义查询的空间资源
		var propName = "shape";

		// 3、定义查询的几何图形
		var geometry = new GeoBeans.Geometry.Point(27.575567,53.899937);

		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		rule.symbolizer = symbolizer;
		style.addRule(rule);
		var maxFeatures = null;
		var fields = null;

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("cities",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 7、删除辅助查询的geometry
		mapObj.removeOverlay("test");
		mapObj.draw();	
	}
	


/* ---
	5、Disjoint查询
	Disjoint返回与给定geometry不在一个范围的记录
---*/

	function queryFeatures_disjoint(){

		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprDisjoint;

		// 2、定义查询的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形		
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();		
	}

/* ---
	6、Touches查询
	Touches 返回与指定geometry相邻的记录，其中geometry应该为图层中某一元素的geometry
---*/

	function queryFeatures_touches(){

		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprTouches;

		// 2、定义查询的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		// 选取地图上的一个数据，这里选取的是乍得
		var wkt = "POLYGON((-4.6621 25.011868, -4.617104 24.973993, -4.214271 24.734779, -3.289939 24.129892, -2.925057 23.871389, -1.447493 22.862917, -0.581719 22.295876, 0 21.924892, 0.178806 21.810862, 1.291033 21.149937, 1.372317 21.03599, 1.329334 20.857763, 1.366432 20.775356, 1.542941 20.649252, 2.043143 20.181808, 2.145668 20.169693, 2.357384 20.310768, 2.621805 20.058077, 2.790359 19.982777, 3.126965 19.972031, 3.266093 19.921995, 3.390756 19.763828, 3.43506 19.528904, 3.362567 19.223375, 3.428833 18.969524, 4.407499 19.153234, 4.436875 18.695757, 4.452055 17.70429, 4.45243 17.272076, 4.41647 16.871428, 4.35152 16.45789, 4.156157 15.897404, 3.888091 15.539876, 3.735861 15.418208, 3.605281 15.360231, 2.46514 15.321734, 1.652023 15.266098, 1.557804 15.233754, 1.304813 15.041577, 1.044254 14.919271, 0.739218 14.942897, 0.477633 14.979502, 0 15.057369, -0.162049 15.083788, -0.322243 15.140054, -0.488965 15.10728, -1.037786 14.786224, -1.463961 14.580303, -1.600796 14.477791, -1.742272 14.121005, -1.86566 14.13299, -2.011553 14.214757, -2.244628 14.308729, -2.36744 14.263509, -2.654379 13.982129, -2.875694 13.682071, -3.052604 13.312349, -3.131121 13.21018, -3.333381 13.164484, -3.581628 13.328284, -3.713571 13.454644, -3.836426 13.428489, -4.015365 13.255804, -4.175025 12.708198, -4.306618 12.237023, -4.449234 12.070913, -4.693618 11.948694, -4.895219 11.877572, -5.010857 11.870539, -5.074431 11.755743, -5.048357 11.418991, -5.108338 11.024528, -5.225888 10.610658, -5.303486 10.463996, -5.324262 10.393946, -5.36013 10.374672, -5.431773 10.32975, -5.703883 10.150153, -5.862382 10.123788, -5.928781 10.231457, -5.981597 10.402769, -5.983371 10.536243, -6.049651 10.631201, -6.165491 10.64959, -6.273137 10.598096, -6.530169 10.380445, -6.69337 10.16971, -6.850798 10.067077, -7.055723 10.262909, -7.310552 10.407601, -7.46906 10.381237, -7.70381 10.138294, -7.955389 10.543635, -8.042779 11.058007, -8.199679 11.381271, -8.412835 11.596136, -8.531894 11.798854, -8.653976 12.17318, -8.663835 12.325683, -8.774582 12.452162, -8.919752 12.476738, -9.227505 12.284204, -9.362338 12.137201, -9.555708 12.027994, -9.810141 12.096423, -9.970565 12.165386, -10.122725 12.177207, -10.336261 11.991598, -10.449827 11.876507, -10.690788 11.995852, -11.087751 12.317712, -11.168997 12.399865, -11.219893 12.41228, -11.19223 12.476012, -11.19017 12.7303, -11.226895 13.105133, -11.345978 13.256994, -11.595391 13.401735, -11.677015 13.490251, -11.775975 13.7058, -11.840661 14.004201, -11.953588 14.499373, -11.928146 14.652086, -11.700137 14.83143, -11.550704 14.959448, -11.5426 15.232854, -11.461338 15.481251, -11.34784 15.596344, -11.166975 15.629192, -11.049551 15.579027, -10.79401 15.205472, -10.697918 15.129756, -10.493792 15.092823, -10.445647 15.213879, -10.47039 15.347229, -10.443469 15.442749, -10.202538 15.38695, -9.88162 15.325272, -9.663227 15.301139, -9.489214 15.31487, -9.063871 15.469947, -8.185128 15.481483, -5.279453 15.485878, -5.10886 16.21155, -5.434465 16.565605, -5.518003 17.226215, -5.609037 18.299971, -5.755165 19.538681, -5.8353 20.320093, -5.920723 20.980711, -6.329557 24.563587, -6.351625 24.913088, -4.897419 24.953297, -4.6621 25.011868))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形		
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 7、辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}


/* ---
	7、Crosses查询
	返回给定geometry穿过的记录
---*/

	function queryFeatures_crosses(){

		// 1、定义查询的操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprCrosses;

		// 2、定义查询的的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		var wkt = "LINESTRING (30 10, 10 30, 40 40)";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形		
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 7、辅助显示查询的geometry
		var lineSymbolizer = new GeoBeans.Symbolizer.LineSymbolizer();
		lineSymbolizer.stroke.color.set(0,0,255,0.6);
		lineSymbolizer.stroke.width = 6;
		var line = new GeoBeans.Overlay.Polyline("test",geometry,lineSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(line);	
		mapObj.draw();		
	}

/* ---
	8、Beyond 查询
	Beyond返回与给定geometry超过一定范围的记录	
---*/
	function queryFeatures_beyond(){

		// 1、定义查询的空间字段
		var propName = "shape";
		
		// 2、定义查询的空间几何图形
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);

		// 3、定义查询的距离
		var distance = 10;

		// 4、Beyond 查询
		// 参数一：propName 为图层的空间字段
		// 参数二：geometry 为查询的空间元素
		// 参数三：distance 为查询的距离
		var filter = new GeoBeans.BeyondFilter(propName,geometry,distance);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("cities",filter,maxFeatures,fields,style,queryFeatures_callback);		


		// 7、辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}

/* ---
	9、Contains 查询
	Contains 查询返回包含给定geometry的记录
---*/
	function queryFeatures_contains(){

		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprContains;

		// 2、定义查询的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		var geometry = new GeoBeans.Geometry.Point(10,20);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形		
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);


		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	

		// 7、辅助显示查询的geometry
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		var marker = new GeoBeans.Overlay.Marker("test",geometry,symbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(marker);
		mapObj.draw();
	}

/* ---
	10、Overlaps 查询
	返回与给定的geometry重叠的记录
---*/
	function queryFeatures_overlaps(){
		// 1、定义查询操作符
		var operator = GeoBeans.SpatialFilter.OperatorType.SpOprOverlaps;
		
		// 2、定义查询的空间字段
		var propName = "shape";

		// 3、定义查询的几何图形
		var wkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		
		// 4、定义查询过滤条件
		// 参数一：operator 查询操作符
		// 参数二：propName 查询的空间字段
		// 参数三：geometry 查询的几何图形		
		var filter = new GeoBeans.BinarySpatialFilter(operator,propName,geometry);

		// 5、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		symbolizer.fill.color.set(255,65,65,0.9);
		symbolizer.stroke = null;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 6、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("country",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 7、辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}
/* ---
	11、BBox 查询
	BBOX 返回给定geometry里面的记录
---*/
	function queryFeatures_bbox(){

		// 1、定义查询的空间字段
		var propName = "shape";

		// 2、定义查询的空间几何图形，定义一个矩形
		var extent = new GeoBeans.Envelope(30,40,60,60);

		// 3、bbox 查询
		// 参数一：propName 为图层的空间字段
		// 参数二：extent 为查询的矩形范围
		var filter = new GeoBeans.BBoxFilter(propName,extent);

		// 4、设定查询返回结果的样式
		var style = new GeoBeans.Style.FeatureStyle();
		var rule = new GeoBeans.Rule();
		var symbolizer = new GeoBeans.Symbolizer.PointSymbolizer();
		var symbol = new GeoBeans.Symbol();
		symbol.icon = "./images/circle.png";
		symbolizer.symbol = symbol;
		rule.symbolizer = symbolizer;
		style.addRule(rule);

		// 5、查询
		// 参数一：查询图层名称，参数二：filter查询过滤条件，如果为null,则返回所有的结果
		// 参数三：maxFeatures返回结果数，参数四：fields为请求的字段
		// 参数五：style为查询结果的绘制样式，参数六：callback回调函数返回查询结果
		var maxFeatures = null;
		var fields = null;
		mapObj.getFeatureFilter("cities",filter,maxFeatures,fields,style,queryFeatures_callback);	


		// 6、辅助显示查询的geometry
		var polygonSymbolizer = new GeoBeans.Symbolizer.PolygonSymbolizer();
		polygonSymbolizer.fill.color.set(126, 40, 0,0.6);
		polygonSymbolizer.stroke.color.set(255, 0, 0,0.6);
		polygonSymbolizer.stroke.width = 1;
		var wkt = "POLYGON ((30 40,30 60, 60 60, 60 40, 30 40))";
		var geometry = GeoBeans.Utility.createGeometryFromWKT(wkt);
		var polygon = new GeoBeans.Overlay.Polygon("test",geometry,polygonSymbolizer);
		mapObj.removeOverlay("test");
		mapObj.addOverlay(polygon);	
		mapObj.draw();
	}
</script>
<title>Map5 -- WFS图层-- 空间查询</title>
<body onload="init()">
	<!-- mapDiv 为初始化地图的容器，给定高度和宽度，并指定定位方式为绝对定位 -->
	<div id="mapDiv" style="height:800px;width:100%;position:absolute;top:60px;">
	</div>
	
	<button onclick="queryFeatures_intersects()">Intersects</button>
	<button onclick="queryFeatures_dwithin()">Dwithin</button>
	<button onclick="queryFeatures_within()">Within</button>
	<button onclick="queryFeatures_equals()">Equals</button>
	<button onclick="queryFeatures_disjoint()">Disjoint</button>
	<button onclick="queryFeatures_touches()">Touches</button>
	<button onclick="queryFeatures_crosses()">Crosses</button>
	<button onclick="queryFeatures_beyond()">Beyond</button>
	<button onclick="queryFeatures_contains()">Contains</button>
	<button onclick="queryFeatures_bbox()">BBox</button>
	<button onclick="queryFeatures_overlaps()">Overlaps</button>
	<button onclick="clearQuery()">停止查询</button>
	<br/>
	<div id="result">
		返回的结果个数：<span></span>
	</div>
</body>
	